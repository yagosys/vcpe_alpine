docker stop vcpe_andy015
docker rm vcpe_andy015
#docker network create -d bridge --subnet 172.25.1.0/24 isolated_nw
docker run -it -d --privileged -v /lib/modules:/lib/modules:ro -p 8123:8123 --env ROOT_PASSWORD=MyRootPW123 --env CANALBOX_SN=andy015 --env CORE='120.55.58.18' --env FRP_SSH_PORT=6215 --env FRP_POLIPO_PORT=6315 --name vcpe_andy015  interbeing/vcpe_alpine  

function get_vap(){
vap=`docker exec -it vcpe_andy015 bin/ash -c 'ipsec status' | grep ROUTED | awk '{print $1}'  | cut -d '{' -f 1`
echo waiting for vap to come up ,now vap is $vap
sleep 1
}

function restart_ipsec() {
get_vap
if [[ $vap = *"vap-"* ]] ; then
	echo vap has been created with name $vap
	docker exec -it vcpe_andy015 bin/ash -c 'ipsec restart'
	sleep 1
	docker exec -it vcpe_andy015 bin/ash -c 'ipsec up '$vap''
fi
}

get_vap
until  [[ $vap = *"vap-"* ]] ; do
	restart_ipsec
         done


